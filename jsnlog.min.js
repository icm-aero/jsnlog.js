/* 
 * JSNLog 2.30.0
 * Open source under the MIT License.
 * Copyright 2012-2017 Mattijs Perdeck All rights reserved.
 */
var __extends=this&&this.__extends||function(){var n=function(r,f){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,l){a.__proto__=l}||function(a,l){for(var h in l)Object.prototype.hasOwnProperty.call(l,h)&&(a[h]=l[h])},n(r,f)};return function(r,f){if(typeof f!="function"&&f!==null)throw new TypeError("Class extends value "+String(f)+" is not a constructor or null");n(r,f);function a(){this.constructor=r}r.prototype=f===null?Object.create(f):(a.prototype=f.prototype,new a)}}();function JL(n){if(!n)return JL.__;Array.prototype.reduce||(Array.prototype.reduce=function(a,l){for(var h=l,g=0;g<this.length;g++)h=a(h,this[g],g,this);return h});var r="",f=("."+n).split(".").reduce(function(a,l,h,g){r?r+="."+l:r=l;var d=a["__"+r];return d===void 0&&(JL.Logger.prototype=a,d=new JL.Logger(r),a["__"+r]=d),d},JL.__);return f}(function(n){n.requestId="",n.entryId=0,n._createXMLHttpRequest=function(){return new XMLHttpRequest},n._getTime=function(){return new Date().getTime()},n._console=console,n._appenderNames=[];function r(t,e,i){if(e[t]!==void 0){if(e[t]===null){delete i[t];return}i[t]=e[t]}}function f(t){if(n.enabled!=null&&!n.enabled)return!1;try{if(t.userAgentRegex&&!new RegExp(t.userAgentRegex).test(navigator.userAgent))return!1}catch{}try{if(t.ipRegex&&n.clientIP&&!new RegExp(t.ipRegex).test(n.clientIP))return!1}catch{}return!0}function a(t,e){try{if(t.disallow&&new RegExp(t.disallow).test(e))return!1}catch{}return!0}function l(t){return typeof t=="function"?t instanceof RegExp?t.toString():t():t}var h=function(){function t(e,i,c){this.msg=e,this.meta=i,this.finalString=c}return t}();function g(t){var e=l(t),i;switch(typeof e){case"string":return new h(e,null,e);case"number":return i=e.toString(),new h(i,null,i);case"boolean":return i=e.toString(),new h(i,null,i);case"undefined":return new h("undefined",null,"undefined");case"object":return e instanceof RegExp||e instanceof String||e instanceof Number||e instanceof Boolean?(i=e.toString(),new h(i,null,i)):(typeof n.serialize=="function"?i=n.serialize.call(this,e):i=JSON.stringify(e),new h("",e,i));default:return new h("unknown",null,"unknown")}}function d(t){return r("enabled",t,this),r("maxMessages",t,this),r("defaultAjaxUrl",t,this),r("clientIP",t,this),r("requestId",t,this),r("defaultBeforeSend",t,this),r("serialize",t,this),this}n.setOptions=d;function E(){return-2147483648}n.getAllLevel=E;function _(){return 1e3}n.getTraceLevel=_;function B(){return 2e3}n.getDebugLevel=B;function I(){return 3e3}n.getInfoLevel=I;function b(){return 4e3}n.getWarnLevel=b;function T(){return 5e3}n.getErrorLevel=T;function x(){return 6e3}n.getFatalLevel=x;function C(){return 2147483647}n.getOffLevel=C;function k(t){return t<=1e3?"trace":t<=2e3?"debug":t<=3e3?"info":t<=4e3?"warn":t<=5e3?"error":"fatal"}var A=function(){function t(e,i){this.inner=i,this.name="JL.Exception",this.message=g(e).finalString}return t}();n.Exception=A,A.prototype=new Error;var O=function(){function t(e,i,c,o,s){this.l=e,this.m=i,this.n=c,this.t=o,this.u=s}return t}();n.LogItem=O;function R(t,e,i){return n.entryId++,new O(t,e,i,n._getTime(),n.entryId)}function j(t){t.id&&(clearTimeout(t.id),t.id=null)}function z(t,e,i){var c=this;t.id||(t.id=setTimeout(function(){i.call(c)},e))}var y=function(){function t(e,i){this.appenderName=e,this.sendLogItems=i,this.level=n.getTraceLevel(),this.sendWithBufferLevel=2147483647,this.storeInBufferLevel=-2147483648,this.bufferSize=0,this.batchSize=1,this.maxBatchSize=20,this.batchTimeout=2147483647,this.sendTimeout=5e3,this.successCallback=function(){},this.errorCallback=function(){},this.buffer=[],this.batchBuffer=[],this.batchTimeoutTimer={id:null},this.sendTimeoutTimer={id:null},this.nbrLogItemsSkipped=0,this.nbrLogItemsBeingSent=0;var c="Trying to create an appender without a name or with an empty name";if(e==null)throw c;if(n._appenderNames.indexOf(e)!=-1)throw e?"Multiple appenders use the same name "+e:c;n._appenderNames.push(e)}return t.prototype.addLogItemsToBuffer=function(e){if(this.batchBuffer.length>=this.maxBatchSize){this.nbrLogItemsSkipped+=e.length;return}if(n.maxMessages!=null){if(n.maxMessages<1)return;n.maxMessages-=e.length}this.batchBuffer=this.batchBuffer.concat(e);var i=this;z(this.batchTimeoutTimer,this.batchTimeout,function(){i.sendBatch.call(i)})},t.prototype.batchBufferHasOverdueMessages=function(){for(var e=0;e<this.batchBuffer.length;e++){var i=n._getTime()-this.batchBuffer[e].t;if(i>this.batchTimeout)return!0}return!1},t.prototype.batchBufferHasStrandedMessage=function(){return n.maxMessages!=null&&n.maxMessages<1&&this.batchBuffer.length>0},t.prototype.sendBatchIfComplete=function(){(this.batchBuffer.length>=this.batchSize||this.batchBufferHasOverdueMessages()||this.batchBufferHasStrandedMessage())&&this.sendBatch()},t.prototype.onSendingEnded=function(){j(this.sendTimeoutTimer),this.nbrLogItemsBeingSent=0,this.sendBatchIfComplete()},t.prototype.setOptions=function(e){if(r("level",e,this),r("ipRegex",e,this),r("userAgentRegex",e,this),r("disallow",e,this),r("sendWithBufferLevel",e,this),r("storeInBufferLevel",e,this),r("bufferSize",e,this),r("batchSize",e,this),r("maxBatchSize",e,this),r("batchTimeout",e,this),r("sendTimeout",e,this),r("successCallback",e,this),r("errorCallback",e,this),this.bufferSize<this.buffer.length&&(this.buffer.length=this.bufferSize),this.maxBatchSize<this.batchSize)throw new n.Exception({message:"maxBatchSize cannot be smaller than batchSize",maxBatchSize:this.maxBatchSize,batchSize:this.batchSize});return this},t.prototype.log=function(e,i,c,o,s,u,p){var m;if(f(this)&&a(this,u)&&!(s<this.storeInBufferLevel)){if(m=R(s,u,p),s<this.level){this.bufferSize>0&&(this.buffer.push(m),this.buffer.length>this.bufferSize&&this.buffer.shift());return}this.addLogItemsToBuffer([m]),s>=this.sendWithBufferLevel&&this.buffer.length&&(this.addLogItemsToBuffer(this.buffer),this.buffer.length=0),this.sendBatchIfComplete()}},t.prototype.sendBatch=function(){if(!(this.nbrLogItemsBeingSent>0)&&(j(this.batchTimeoutTimer),this.batchBuffer.length!=0)){this.nbrLogItemsBeingSent=this.batchBuffer.length;var e=this;z(this.sendTimeoutTimer,this.sendTimeout,function(){e.onSendingEnded.call(e)}),this.sendLogItems(this.batchBuffer,function(){e.batchBuffer.splice(0,e.nbrLogItemsBeingSent),e.nbrLogItemsSkipped>0&&(e.batchBuffer.push(R(b(),"Lost "+e.nbrLogItemsSkipped+" messages. Either connection with the server was down or logging was disabled via the enabled option. Reduce lost messages by increasing the ajaxAppender option maxBatchSize.",e.appenderName)),e.nbrLogItemsSkipped=0),e.onSendingEnded.call(e)})}},t}();n.Appender=y;var w=function(t){__extends(e,t);function e(i){return t.call(this,i,e.prototype.sendLogItemsAjax)||this}return e.prototype.setOptions=function(i){return r("url",i,this),r("beforeSend",i,this),t.prototype.setOptions.call(this,i),this},e.prototype.sendLogItemsAjax=function(i,c){try{if(!f(this))return;this.xhr&&this.xhr.readyState!=0&&this.xhr.readyState!=4&&this.xhr.abort(),this.xhr=n._createXMLHttpRequest();var o="/jsnlog.logger";n.defaultAjaxUrl!=null&&(o=n.defaultAjaxUrl),this.url&&(o=this.url),this.xhr.open("POST",o),this.xhr.setRequestHeader("Content-Type","application/json"),this.xhr.setRequestHeader("JSNLog-RequestId",n.requestId);var s=this;this.xhr.onreadystatechange=function(){s.xhr.readyState==4&&s.xhr.status>=200&&s.xhr.status<300&&c()};var u={r:n.requestId,lg:i};typeof this.beforeSend=="function"?this.beforeSend.call(this,this.xhr,u):typeof n.defaultBeforeSend=="function"&&n.defaultBeforeSend.call(this,this.xhr,u);var p=JSON.stringify(u);this.xhr.send(p),this.successCallback&&this.successCallback()}catch{this.errorCallback&&this.errorCallback()}},e}(y);n.AjaxAppender=w;var v=function(t){__extends(e,t);function e(i){return t.call(this,i,e.prototype.sendLogItemsConsole)||this}return e.prototype.clog=function(i){n._console.log(i)},e.prototype.cerror=function(i){n._console.error?n._console.error(i):this.clog(i)},e.prototype.cwarn=function(i){n._console.warn?n._console.warn(i):this.clog(i)},e.prototype.cinfo=function(i){n._console.info?n._console.info(i):this.clog(i)},e.prototype.cdebug=function(i){n._console.debug?n._console.debug(i):this.cinfo(i)},e.prototype.sendLogItemsConsole=function(i,c){try{if(!f(this)||!n._console)return;var o;for(o=0;o<i.length;++o){var s=i[o],u=s.n+": "+s.m;typeof window>"u"&&(u=new Date(s.t)+" | "+u),s.l<=n.getDebugLevel()?this.cdebug(u):s.l<=n.getInfoLevel()?this.cinfo(u):s.l<=n.getWarnLevel()?this.cwarn(u):this.cerror(u)}}catch{}c()},e}(y);n.ConsoleAppender=v;var M=function(){function t(e){this.loggerName=e,this.seenRegexes=[]}return t.prototype.setOptions=function(e){return r("level",e,this),r("userAgentRegex",e,this),r("disallow",e,this),r("ipRegex",e,this),r("appenders",e,this),r("onceOnly",e,this),this.seenRegexes=[],this},t.prototype.buildExceptionObject=function(e){var i={};return e.stack?i.stack=e.stack:i.e=e,e.message&&(i.message=e.message),e.name&&(i.name=e.name),e.data&&(i.data=e.data),e.inner&&(i.inner=this.buildExceptionObject(e.inner)),i},t.prototype.log=function(e,i,c){var o=0,s,u;if(!this.appenders)return this;if(e>=this.level&&f(this)&&(c?(u=this.buildExceptionObject(c),u.logData=l(i)):u=i,s=g(u),a(this,s.finalString))){if(this.onceOnly)for(o=this.onceOnly.length-1;o>=0;){if(new RegExp(this.onceOnly[o]).test(s.finalString)){if(this.seenRegexes[o])return this;this.seenRegexes[o]=!0}o--}for(s.meta=s.meta||{},o=this.appenders.length-1;o>=0;)this.appenders[o].log(k(e),s.msg,s.meta,function(){},e,s.finalString,this.loggerName),o--}return this},t.prototype.trace=function(e){return this.log(_(),e)},t.prototype.debug=function(e){return this.log(B(),e)},t.prototype.info=function(e){return this.log(I(),e)},t.prototype.warn=function(e){return this.log(b(),e)},t.prototype.error=function(e){return this.log(T(),e)},t.prototype.fatal=function(e){return this.log(x(),e)},t.prototype.fatalException=function(e,i){return this.log(x(),e,i)},t}();n.Logger=M;function q(t){return new w(t)}n.createAjaxAppender=q;function H(t){return new v(t)}n.createConsoleAppender=H;var S;typeof window<"u"?S=new w(""):S=new v(""),n.__=new n.Logger(""),n.__.setOptions({level:n.getDebugLevel(),appenders:[S]})})(JL||(JL={})),typeof exports<"u"&&(exports.__esModule=!0,exports.JL=JL);var define;typeof define=="function"&&define.amd&&define("jsnlog",[],function(){return JL}),typeof __jsnlog_configure=="function"&&__jsnlog_configure(JL),typeof window<"u"&&!window.onerror&&(window.onerror=function(n,r,f,a,l){return JL("onerrorLogger").fatalException({msg:"Uncaught Exception",errorMsg:n?n.message||n:"",url:r,"line number":f,column:a},l),!1}),typeof window<"u"&&!window.onunhandledrejection&&(window.onunhandledrejection=function(n){JL("onerrorLogger").fatalException({msg:"unhandledrejection",errorMsg:n.reason?n.reason.message:n.message||null},n.reason)});
//# sourceMappingURL=jsnlog.min.js.map
